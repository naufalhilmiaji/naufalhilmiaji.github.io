---
import ProjectLayout from "../../layouts/ProjectLayout.astro";
import CodeSection from "../../components/CodeSection.astro";

const sections = [
  { title: "# context" },
  { title: "# problem_space" },
  { title: "# design_goals" },
  { title: "# system_architecture" },
  { title: "# intent_vs_execution" },
  { title: "# provider_choices", foldable: true },
  { title: "# authentication_and_limits", foldable: true },
  { title: "# llm_setup", foldable: true },
  { title: "# limitations", foldable: true },
  { title: "# project_status" },
];
---

<ProjectLayout
  title="directio"
  subtitle="Natural-language interface for places and directions using open map data"
  tech="python · fastapi · local llm · openstreetmap · osrm · docker"
>
  {
    sections.map((section, i) => (
      <CodeSection
        index={i + 2}
        title={section.title}
        foldable={section.foldable}
        summary="expand"
      >
        {section.title === "# context" && (
          <>
            <p>
              Many modern applications require location-aware features such as
              place search, routing, or directions. Implementing this logic
              typically involves complex integrations with geocoding, search,
              and mapping services.
            </p>

            <p>
              At the same time, users increasingly expect to interact with these
              systems using natural language rather than rigid query parameters.
            </p>
          </>
        )}

        {section.title === "# problem_space" && (
          <>
            <p>
              Bridging natural-language input with map-based functionality
              introduces several challenges:
            </p>

            <ul>
              <li>Intent extraction from ambiguous user input</li>
              <li>Reliable execution of geocoding and routing</li>
              <li>Clear separation between inference and side effects</li>
              <li>Avoiding vendor lock-in and payment-gated APIs</li>
            </ul>

            <p>
              Many systems delegate too much responsibility to hosted LLMs or
              tightly couple inference with external API calls.
            </p>
          </>
        )}

        {section.title === "# design_goals" && (
          <ul>
            <li>Accept natural-language map queries via a clean backend API</li>
            <li>Use an LLM strictly for intent and parameter extraction</li>
            <li>Execute all map-related logic deterministically</li>
            <li>Avoid paid or gated external services</li>
            <li>Return frontend-ready, map-compatible JSON</li>
          </ul>
        )}

        {section.title === "# system_architecture" && (
          <pre>
            Client (Web / Mobile) │ ▼ directio API (FastAPI) ├─ Intent
            Extraction (Local LLM) ├─ Validation & Parsing ├─ Provider Layer │
            ├─ Geocoding (Photon) │ └─ Routing (OSRM) └─ Response Formatter
            (JSON)
          </pre>
        )}

        {section.title === "# intent_vs_execution" && (
          <>
            <p>
              A core architectural decision in directio is the strict separation
              between <strong>intent understanding</strong> and
              <strong>backend execution</strong>.
            </p>

            <p>
              The LLM is used only to extract structured intent and parameters
              from natural-language input.
            </p>

            <ul>
              <li>The LLM never calls external APIs</li>
              <li>All map queries are executed by backend providers</li>
              <li>LLM output is validated before execution</li>
            </ul>

            <p>
              This design prevents hallucinated requests from directly
              triggering external side effects.
            </p>
          </>
        )}

        {section.title === "# provider_choices" && (
          <>
            <p>
              directio intentionally relies on OpenStreetMap-based services for
              geocoding and routing.
            </p>

            <ul>
              <li>No billing verification or payment setup</li>
              <li>Fully runnable and reviewable by anyone</li>
              <li>Widely used open alternatives</li>
            </ul>

            <p>
              The provider layer is architecture-agnostic. Replacing Photon or
              OSRM with commercial APIs would primarily involve adapter changes
              rather than a system redesign.
            </p>
          </>
        )}

        {section.title === "# authentication_and_limits" && (
          <>
            <p>
              directio exposes a public API intended for experimentation and
              controlled usage.
            </p>

            <ul>
              <li>API-key authentication</li>
              <li>One API key per email address</li>
              <li>Rate limits enforced per API key</li>
              <li>Key creation endpoint is IP-rate-limited</li>
            </ul>

            <p>This keeps the service usable while preventing abuse.</p>
          </>
        )}

        {section.title === "# llm_setup" && (
          <>
            <p>
              directio uses a local LLM served via Ollama, running in Docker.
            </p>

            <ul>
              <li>No external LLM API keys</li>
              <li>No user data sent to third parties</li>
              <li>Reproducible environment via containerization</li>
            </ul>

            <p>
              The system tolerates imperfect LLM output through validation and
              fallback logic in the backend.
            </p>
          </>
        )}

        {section.title === "# limitations" && (
          <ul>
            <li>// API keys are stored in memory only</li>
            <li>// Local LLM latency depends on hardware</li>
            <li>// Not designed for high-traffic production use</li>
          </ul>
        )}

        {section.title === "# project_status" && (
          <>
            <p>
              directio currently focuses on stable intent extraction, place
              search, routing, and clean API contracts.
            </p>

            <p>
              Planned improvements include persistent key storage, usage
              metrics, frontend examples, and additional provider adapters.
            </p>

            <p>
              Source code:
              <a
                href="https://github.com/naufalhilmiaji/directio"
                target="_blank"
              >
                github.com/naufalhilmiaji/directio
              </a>
            </p>
          </>
        )}
      </CodeSection>
    ))
  }
</ProjectLayout>
